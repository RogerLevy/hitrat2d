+sin  \ enable tokenization of all definitions from here

require config/options.vfx
require config/allegro.vfx

cwd vfxland3
require lib/vl3/vfxland3.vfx
require lib/csv.vfx
require plugins/engine1.vfx
require plugins/bitmaps2.vfx
require plugins/tilemap4.vfx
require lib/files1.vfx
cwd %idir%

include lib/str.vfx
require lib/array.vfx

-sin  \ disable tokenization of all definitions from here

\ ------------------------------------------------------------------------------

: read-csv,  read> lines> csv> evaluate , ;

z" assets/dungeon.png" loadbmp constant dungeon.bmp
dungeon.bmp 16 16 tileset dungeon.ts  

\ ------------------------------------------------------------------------------

: ,,  0 do dup , loop drop ;
\ : *tilemap-alloc
\     2dup 2>r  here %tilemap sizeof +  swap  2r@ *tilemap
\     2r> * -1 swap ,, ;

0 0 at  root in

here -1 20 15 * ,,
create g1  dungeon.ts 20 15 *tilemap drop 
\ create g2  ground2.arr farm.ts 20 15 *tilemap drop
\ create a1  active.arr farm.ts 20 15 *tilemap drop
create actors  %scene ** drop
\ create p1  %player ** as  a1 map !  50 50 x v!  0 0 vx v!

\ ------------------------------------------------------------------------------

include lib/level.vfx
include cast.vfx

0 in
include levels.vfx
    
create rat 64 64 at root in %rat ** as

: reset  0 play  rat [[ 64 64 x v! init ]] ;
reset